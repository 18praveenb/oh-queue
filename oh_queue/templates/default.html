<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="description" content="CS 61A Queue">
    <meta name="keywords" content ="CS61A, Computer Science, CS, 61A, Office Hours, Project, Homework, Party, Parties, Queue" />
    <meta name="author" content="CS 61A Course Staff">
    <meta name="viewport" content="width=device-width">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/mono-blue.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/queue.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='img/favicon.ico') }}">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.8/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/common.js') }}"></script>

    <title>CS 61A Office Hours</title>
    {% if current_user.is_authenticated %}
    <script>
      var current_user_id = {{ current_user.id }};
      {% if current_user.is_staff %}
      var is_staff = true;
      {% else %}
      var is_staff = false;
      {% endif %}
    </script>
    <style>
      {% if current_user.is_staff %}
      .staff-only {display: block !important}
      .student-only {display: none !important}
      .staff-link:hover {
        background: #eee;
        transition: background 0.2s;
        cursor: pointer;
      }
      {% else %}
      .staff-only {display: none !important}
      .student-only {display: block !important}
      .staff-link {
        pointer-events: none;
      }
      {% endif %}
      .hidden, .user-{{ current_user.id }}-hidden {display: none !important}
      .user-{{ current_user.id }}-visible {display: block !important}
    </style>
    {% endif %}
  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="/"><strong>CS 61A</strong> Queue</a>
        </div>
        <div class="collapse navbar-collapse" id="navbar-collapse-section">
          <ul class="nav navbar-nav navbar-right">
            {% if my_ticket %}
              <li><a href="{{ url_for('ticket', ticket_id=my_ticket.id) }}">My Request</a></li>
            {% elif current_user.is_staff %}
              <!-- nothing for staff here yet -->
            {% else %}
              <li><a href="{{ url_for('create') }}">Request Help</a></li>
            {% endif %}
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">{{ current_user.name }}<span class="caret"></span></a>
              <ul class="dropdown-menu">
                {% if current_user.is_staff %}
                  <li><a href="/">Settings</a></li>
                  <li><a href="/">Resolved</a></li>
                {% endif %}
                <li><a href="{{ url_for('auth.logout') }}">Log out</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="jumbotron">
      <div class="container">
        <section class="page-header">
          <h1>Hello, {{ current_user.name.split()[0] }}</h1>
          <p>Signed in as {{ current_user.email }}</p>
          {% if my_ticket %}
            <h2><a class="btn btn-lg" href="{{ url_for('ticket', ticket_id=my_ticket.id) }}">My Request</a></h2>
          {% elif current_user.is_staff %}
            <!-- nothing for staff here yet -->
          {% else %}
            <h2><a class="btn btn-lg" href="{{ url_for('create') }}">Request Help</a></h2>
          {% endif %}
        </section>
      </div>
    </div>
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="alert alert-{{ category }} alert-dismissible" role="alert">
      <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      {{ message }}
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}
    {% block body %}{% endblock %}
  </body>
</html>
